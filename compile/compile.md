go build -o server main.go

Go 编译器默认编译出来的程序会带有符号表和调试信息，一般来说 release 版本可以去除调试信息以减小二进制体积。
go build -ldflags="-s -w" -o server main.go
- -s：忽略符号表和调试信息。
- -w：忽略DWARFv3调试信息，使用该选项后将无法使用gdb进行调试。

upx 是一个常用的压缩动态库和可执行文件的工具，通常可减少 50-70% 的体积。
go build -o server main.go && upx -9 server

go build -ldflags="-s -w" -o server main.go && upx -9 server

# upx 的原理
upx 压缩后的程序和压缩前的程序一样，无需解压仍然能够正常地运行，这种压缩方法称之为带壳压缩，压缩包含两个部分：

- 在程序开头或其他合适的地方插入解压代码；
- 将程序的其他部分压缩。

执行时，也包含两个部分：

- 首先执行的是程序开头的插入的解压代码，将原来的程序在内存中解压出来
- 再执行解压后的程序。

也就是说，upx 在程序执行时，会有额外的解压动作，不过这个耗时几乎可以忽略。

如果对编译后的体积没什么要求的情况下，可以不使用 upx 来压缩。一般在服务器端独立运行的后台服务，无需压缩体积。